import pygame
import sys

# Inicjalizacja
pygame.init()
SZEROKOSC, WYSOKOSC = 600, 400
OKNO = pygame.display.set_mode((SZEROKOSC, WYSOKOSC))
pygame.display.set_caption("Pong z AI")

# Kolory
BIALY = (255, 255, 255)
ZIELONY = (0, 255, 0)
CZERWONY = (255, 0, 0)
CZARNY = (0, 0, 0)

# Parametry
SZEROKOSC_PALETKI, WYSOKOSC_PALETKI = 100, 10
PROMIEN_PILKI = 10
przyspieszenie_pilki = 0.3
predkosc_ai = 5
czcionka = pygame.font.SysFont(None, 36)
zegar = pygame.time.Clock()

def zresetuj_gre():
    global gracz, ai, pilka, predkosc_pilki
    gracz = pygame.Rect(SZEROKOSC // 2 - SZEROKOSC_PALETKI // 2, WYSOKOSC - 30, SZEROKOSC_PALETKI, WYSOKOSC_PALETKI)
    ai = pygame.Rect(SZEROKOSC // 2 - SZEROKOSC_PALETKI // 2, 20, SZEROKOSC_PALETKI, WYSOKOSC_PALETKI)
    pilka = pygame.Rect(SZEROKOSC // 2, WYSOKOSC // 2, PROMIEN_PILKI, PROMIEN_PILKI)
    predkosc_pilki = [4, 4]

def rysuj_obiekty():
    OKNO.fill(CZARNY)
    pygame.draw.rect(OKNO, ZIELONY, gracz)
    pygame.draw.rect(OKNO, CZERWONY, ai)
    pygame.draw.ellipse(OKNO, BIALY, pilka)
    pygame.display.flip()

def pokaz_koniec_gry():
    OKNO.fill(CZARNY)
    tekst1 = czcionka.render("KONIEC GRY", True, CZERWONY)
    tekst2 = czcionka.render("Naciśnij R, aby zrestartować", True, BIALY)
    OKNO.blit(tekst1, (SZEROKOSC // 2 - 80, WYSOKOSC // 2 - 30))
    OKNO.blit(tekst2, (SZEROKOSC // 2 - 150, WYSOKOSC // 2 + 10))
    pygame.display.flip()

def main():
    zresetuj_gre()
    dziala = True
    koniec = False

    while dziala:
        zegar.tick(60)
        for zdarzenie in pygame.event.get():
            if zdarzenie.type == pygame.QUIT:
                dziala = False

        klawisze = pygame.key.get_pressed()

        if koniec:
            if klawisze[pygame.K_r]:
                zresetuj_gre()
                koniec = False
            continue

        # Ruch gracza (zwiększona szybkość)
        if klawisze[pygame.K_a]:
            gracz.x -= 8
        if klawisze[pygame.K_d]:
            gracz.x += 8
        gracz.x = max(0, min(SZEROKOSC - SZEROKOSC_PALETKI, gracz.x))

        # Ruch AI
        if ai.centerx < pilka.centerx:
            ai.x += predkosc_ai
        elif ai.centerx > pilka.centerx:
            ai.x -= predkosc_ai
        ai.x = max(0, min(SZEROKOSC - SZEROKOSC_PALETKI, ai.x))

        # Ruch piłki
        pilka.x += int(predkosc_pilki[0])
        pilka.y += int(predkosc_pilki[1])

        # Odbicia od ścian
        if pilka.left <= 0 or pilka.right >= SZEROKOSC:
            predkosc_pilki[0] *= -1

        # Odbicia od paletek i przyspieszenie
        if pilka.colliderect(gracz) and predkosc_pilki[1] > 0:
            predkosc_pilki[1] *= -1
            predkosc_pilki[0] *= 1 + przyspieszenie_pilki
            predkosc_pilki[1] *= 1 + przyspieszenie_pilki

        if pilka.colliderect(ai) and predkosc_pilki[1] < 0:
            predkosc_pilki[1] *= -1
            predkosc_pilki[0] *= 1 + przyspieszenie_pilki
            predkosc_pilki[1] *= 1 + przyspieszenie_pilki

        # Koniec gry
        if pilka.top > WYSOKOSC or pilka.bottom < 0:
            pokaz_koniec_gry()
            koniec = True
            continue

        rysuj_obiekty()

    pygame.quit()
    sys.exit()

if __name__ == "__main__":
    main()
